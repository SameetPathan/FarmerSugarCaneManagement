import React, { Component } from 'react';
import { RichTextEditorComponent, Inject, Toolbar, Image, Link, HtmlEditor, QuickToolbar, PasteCleanup } from '@syncfusion/ej2-react-richtexteditor';
import { Storage } from 'aws-amplify';

class MyComponent extends Component {
  constructor(props) {
    super(props);

    this.state = {
      description: '',
      imagePath: ''
    };

    this.toolbarSettings = {
      items: ['Bold', 'Italic', 'Underline', '|', 'Formats', 'Alignments', '|', 'Image', 'Link', '|', 'Undo', 'Redo']
    };
  }

  async handleImageUpload(e) {
    const imageFile = e.target.files[0];
    const imageName = imageFile.name;
    const imageType = imageFile.type;
    const imagePath = `images/${imageName}`;

    try {
      await Storage.put(imagePath, imageFile, { contentType: imageType });
      this.setState({
        imagePath: imagePath
      });
    } catch (error) {
      console.log(error);
    }
  }

  handleDescriptionChange(args) {
    const description = this.rteObj.getContent();

    this.setState({
      description
    });
  }

  render() {
    return (
      <div>
        <RichTextEditorComponent
          ref={(richtexteditor) => { this.rteObj = richtexteditor; }}
          toolbarSettings={this.toolbarSettings}
          change={this.handleDescriptionChange.bind(this)}
        >
          <Inject services={[Toolbar, Image, Link, HtmlEditor, QuickToolbar, PasteCleanup]} />
        </RichTextEditorComponent>

        <input type="file" onChange={this.handleImageUpload.bind(this)} />

        <button onClick={() => console.log(this.state)}>Save</button>
      </div>
    );
  }
}

export default MyComponent;
