import React, { Component } from 'react';
import {
  RichTextEditorComponent,
  HtmlEditor,
  Table,
  Inject,
  Toolbar,
  Link,
  Image,
  QuickToolbar,
  PasteCleanup
} from '@syncfusion/ej2-react-richtexteditor';
import { Storage } from 'aws-amplify';

class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      content: '',
      s3ImageUrl: ''
    };
    this.toolbarSettings = {
      items: ['Bold', 'Italic', 'Underline', 'FontColor', 'BackgroundColor', '|',
        'Formats', 'Alignments', 'OrderedList', 'UnorderedList', '|',
        'CreateLink', 'Image', '|', 'Undo', 'Redo']
    };
  }

  onImageUploadSuccess = async (e) => {
    // Get the uploaded image from the RichTextEditor
    const file = e.file as File;
    // Upload the file to S3 using Amplify Storage module
    const s3ImageUrl = await Storage.put(`document_gathering/${file.name}`, file, {
      contentType: file.type,
    });
    // Set the S3 image URL in the state variable
    this.setState({ s3ImageUrl });
  };

  onContentChange = (args) => {
    // Update the content state variable with the new RichTextEditor content
    const content = args.value;
    this.setState({ content });
  };

  render() {
    return (
      <div>
        <RichTextEditorComponent
          ref={(richtexteditor) => { this.rteObj = richtexteditor; }}
          toolbarSettings={this.toolbarSettings}
          imageUploadSuccess={this.onImageUploadSuccess}
          change={this.onContentChange}
        >
          <Inject services={[Toolbar, Image, Link, HtmlEditor, QuickToolbar, PasteCleanup]} />
        </RichTextEditorComponent>
        <button onClick={() => {
          // Construct the final HTML content with the S3 image URL and the user-entered text
          const content = `<p>${this.state.content}</p><img src="${this.state.s3ImageUrl}" />`;
          console.log(content); // Use the content variable as needed
        }}>Save</button>
      </div>
    );
  }
}

export default App;
